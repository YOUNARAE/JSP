<%@page import="java.util.Date"%>
<%@page import="java.util.Locale"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>05/autoRequest.jsp</title>
<script type="text/javascript" src="${pageContext.request.contextPath}/resources/jquery-3.6.1.min.js"></script>
</head>
<body>
<!-- 문제 : radio버튼을 이용해서 파일 형식에 맞게 출력될 수 있도록하고,시작,중단버튼을 이용해서
          시간 제어가 가능해야한다. -->
<%--
	response.setIntHeader("Refresh", 1);
--%>
<%-- =new Date()--%>
<h4>현재 서버의 시간 : <span class="timeArea"> </span></h4>
<button class="controlBtn"  data-control-type="START">시작</button>
<button class="controlBtn"  data-control-type="STOP">멈춤</button>
<input type="radio" name="dataType" data-data-type="json" />JSON
<input type="radio" name="dataType" data-data-type="text" />PLAIN
<input type="radio" name="locale" value="<%=Locale.KOREAN.toLanguageTag()%>" checked />한국어
<input type="radio" name="locale" value="<%=Locale.ENGLISH.toLanguageTag()%>" />영어
<input type="radio" name="locale" value="<%=Locale.JAPANESE.toLanguageTag()%>" />일본어

<script type="text/javascript">
	// 먼저 jsp에서 UI 작업을 먼저 해준다
	let timeArea = $("#timeArea"); // span태그를 아이디를 이용해 timeArea에 제이쿼리 객체로 담는다 
	//1단계 : 없던 버튼이 생겼다. 버튼에 대한 이벤트를 처리해준다
	// 이벤트는 클릭이벤트다.
	let controlBtns = $(".controlBtn").on("click",function(){ //.controlBtn를 제이쿼리 객체로 만들어서 클릭이벤트를 열어준다
		//버튼이 2개이기 때문에 2개를 걸러주는 작업을 해야한다.
		//이 버튼을 눌렀을 때
		let controlType = $(this).data("controlType"); 
		//눌린 버튼을 제이쿼리 객체화를 시켜서 controlType에 담았다
		console.log(controlType);
		if(controlType=="START"){
			버튼이 시작하면 시계가 작동해야된다
			let watch = setInterval(sendRequest,1000);
		} else {
			//버튼이 중지일 때 시계가 멈춘다
			clearInterval(sendRequest);
		}
	});
	
	
	//2단계 : 라디오버튼이 선택되면 선택된 json이나 text dataType으로 떠야한다
	
	//3단계 : 라디오 버튼이 선택되면 선택된 언어로 파라미터를 받아와야한다.
	
	let sendRequest = function(){
		$.ajax({
			url : "${pageContext.request.contextPath}/05/getServerTimeCopy",
			dataType : "json",
			success : function(resp){
				timeArea.html(resp.now);
			},
			error : function(jqXHR, status, error) {
				console.log(jqXHR);
				console.log(status);
				console.log(error);
			}
		});
	}


</script>
</body>
</html>